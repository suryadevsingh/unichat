{"ast":null,"code":"import _regeneratorRuntime from\"D:\\\\Web\\\\unichat\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"D:\\\\Web\\\\unichat\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:\\\\Web\\\\unichat\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useRef,useEffect,useState}from\"react\";import{useHistory}from\"react-router-dom\";import{ChatEngine}from\"react-chat-engine\";import{auth}from\"../firebase\";import{useAuth}from\"../contexts/AuthContext\";import axios from\"axios\";var Chats=function Chats(){var history=useHistory();var _useAuth=useAuth(),user=_useAuth.user;var _useState=useState(true),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];console.log(user);var handleLogout=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return auth.signOut();case 2:history.push(\"./\");case 3:case\"end\":return _context.stop();}}},_callee);}));return function handleLogout(){return _ref.apply(this,arguments);};}();var getFile=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(url){var response,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return fetch(url);case 2:response=_context2.sent;_context2.next=5;return response.blob();case 5:data=_context2.sent;return _context2.abrupt(\"return\",new File([data],\"userPhoto.jpg\",{type:\"image/jpeg\"}));case 7:case\"end\":return _context2.stop();}}},_callee2);}));return function getFile(_x){return _ref2.apply(this,arguments);};}();useEffect(function(){if(!user){history.push(\"./\");return;}axios.get(\"https://api.chatengine.io/users/me\",{headers:{\"project-id\":process.env.REACT_APP_CHAT_ENGINE_ID,\"user-name\":user.email,\"user-secret\":user.uid}}).then(function(){setLoading(false);}).catch(function(){var formdata=new FormData();formdata.append(\"email\",user.email);formdata.append(\"username\",user.email);formdata.append(\"secret\",user.uid);getFile(user.photoURL).then(function(avatar){formdata.append(\"avatar\",avatar,avatar.name);axios.post(\"https://api.chatengine.io/users\",formdata,{headers:{\"private-key\":process.env.REACT_APP_CHAT_ENGINE_KEY}}).then(function(){return setLoading(false);}).catch(function(error){return console.log(error);});});});},[user,history]);if(!user||loading)return\"loading....\";return/*#__PURE__*/React.createElement(\"div\",{className:\"chats-page\"},/*#__PURE__*/React.createElement(\"div\",{className:\"nav-bar\"},/*#__PURE__*/React.createElement(\"div\",{className:\"logo-tab\"},\"Unichat\"),/*#__PURE__*/React.createElement(\"div\",{className:\"logout-tab\",onClick:handleLogout},\"Logout\")),/*#__PURE__*/React.createElement(ChatEngine,{height:\"calc(100vh - 66px)\",projectID:process.env.REACT_APP_CHAT_ENGINE_ID,userName:user.email,userSecret:user.uid}));};export default Chats;","map":{"version":3,"sources":["D:/Web/unichat/src/components/Chats.js"],"names":["React","useRef","useEffect","useState","useHistory","ChatEngine","auth","useAuth","axios","Chats","history","user","loading","setLoading","console","log","handleLogout","signOut","push","getFile","url","fetch","response","blob","data","File","type","get","headers","process","env","REACT_APP_CHAT_ENGINE_ID","email","uid","then","catch","formdata","FormData","append","photoURL","avatar","name","post","REACT_APP_CHAT_ENGINE_KEY","error"],"mappings":"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","sourcesContent":["import React, { useRef, useEffect, useState } from \"react\";\r\nimport { useHistory } from \"react-router-dom\";\r\nimport { ChatEngine } from \"react-chat-engine\";\r\nimport { auth } from \"../firebase\";\r\n\r\nimport { useAuth } from \"../contexts/AuthContext\";\r\nimport axios from \"axios\";\r\n\r\nconst Chats = () => {\r\n  const history = useHistory();\r\n  const { user } = useAuth();\r\n  const [loading, setLoading] = useState(true);\r\n  console.log(user);\r\n\r\n  const handleLogout = async () => {\r\n    await auth.signOut();\r\n    history.push(\"./\");\r\n  };\r\n\r\n  const getFile = async (url) => {\r\n    const response = await fetch(url);\r\n    const data = await response.blob();\r\n\r\n    return new File([data], \"userPhoto.jpg\", { type: \"image/jpeg\" });\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!user) {\r\n      history.push(\"./\");\r\n\r\n      return;\r\n    }\r\n    axios\r\n      .get(\"https://api.chatengine.io/users/me\", {\r\n        headers: {\r\n          \"project-id\": process.env.REACT_APP_CHAT_ENGINE_ID,\r\n          \"user-name\": user.email,\r\n          \"user-secret\": user.uid,\r\n        },\r\n      })\r\n      .then(() => {\r\n        setLoading(false);\r\n      })\r\n      .catch(() => {\r\n        let formdata = new FormData();\r\n        formdata.append(\"email\", user.email);\r\n        formdata.append(\"username\", user.email);\r\n        formdata.append(\"secret\", user.uid);\r\n\r\n        getFile(user.photoURL).then((avatar) => {\r\n          formdata.append(\"avatar\", avatar, avatar.name);\r\n\r\n          axios\r\n            .post(\"https://api.chatengine.io/users\", formdata, {\r\n              headers: {\r\n                \"private-key\": process.env.REACT_APP_CHAT_ENGINE_KEY,\r\n              },\r\n            })\r\n            .then(() => setLoading(false))\r\n            .catch((error) => console.log(error));\r\n        });\r\n      });\r\n  }, [user, history]);\r\n\r\n  if (!user || loading) return \"loading....\";\r\n  return (\r\n    <div className=\"chats-page\">\r\n      <div className=\"nav-bar\">\r\n        <div className=\"logo-tab\">Unichat</div>\r\n        <div className=\"logout-tab\" onClick={handleLogout}>\r\n          Logout\r\n        </div>\r\n      </div>\r\n      <ChatEngine\r\n        height=\"calc(100vh - 66px)\"\r\n        projectID={process.env.REACT_APP_CHAT_ENGINE_ID}\r\n        userName={user.email}\r\n        userSecret={user.uid}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Chats;\r\n"]},"metadata":{},"sourceType":"module"}